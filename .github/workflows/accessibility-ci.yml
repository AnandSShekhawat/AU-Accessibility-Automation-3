name: Automated Accessibility Scan

on:
  push:
  workflow_dispatch:

jobs:
  accessibility:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          npm install -g @axe-core/cli serve

      - name: Serve site locally
        run: |
          serve . -l 3000 &
          sleep 5

      - name: Run axe scan and save report
        run: |
          axe http://localhost:3000/before.html \
            --format json \
            --save a11y-report.json

      - name: Create separate issues for axe violations
        uses: insights-oss/axe-linter-action@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          path: a11y-report.json
          include:
            - wcag2a
            - wcag2aa
          labels: |
            a11y-scan
            copilot:accessibility
